<html>
<lang="ja">

  <head prefix="og: http://ogp.me/ns#">
    <title>ホーム</title>
    <meta name="description" content="リアルタイム投票サービス　AICEVOTE　（アイスボート）のホームメニューです。">
    <meta property="og:title" content="AICEVOTE">
    <meta property="og:type" content="website">
    <meta property="og:description" content="票を氷にしたリアルタイム投票サイト">
    <meta property="og:url" content="aicevote.com">
    <meta property="og:site_name" content="AICEVOTE">
    <meta property="og:image" content="http://aicevote.com/images/aicevote_2_skeleton.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script src="https://unpkg.com/aicevote/dist/aicevote.js"></script>
    <script src="/javascripts/auth.js"></script>

    <script src="/javascripts/moment.js"></script>
    <script src="/javascripts/Chart.min.js"></script>
    <script src="/javascripts/chartjs-plugin-streaming.js"></script>
    <script src="/javascripts/ajax.js"></script>


    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-141182013-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config', 'UA-141182013-1');
    </script>
  </head>

  <body>
    <script>
      let param = (new URL(document.location)).searchParams;
      let id = param.get('id');
      let which = param.get('which');

      async function main() {
        var sessionToken = null;
        try {
          const sessionID = getSessionID();
          sessionToken = await aicevote.getSessionToken(sessionID);
          const myProfile = await aicevote.getMyProfile(sessionToken);
          $('.login').remove();
          const userimg = document.getElementById('userimg');
          userimg.innerHTML = `<a href="user.html?id=${myProfile.userID}&which=${myProfile.userProvider}"><img src="images/user.png"></a>`;
        } catch (e) {
          deleteSessionID();
          $('#userimg').remove();
          $('#onlyinfluencer').remove();
        }
        try {
          const themes = await aicevote.getAllThemes();
          try {
            if (which == "twitter") {
              hisProfile = await aicevote.getProfile("twitter",id);
            } else if (which == "legacy") {
              hisProfile = await aicevote.getProfile("legacy",id);
            }
          } catch (e) {
            const profile2 = document.getElementById('profile2');
            profile2.innerHTML = `<h4><img src="/images/person.png" >ユーザーが見つかりませんでした</h4>`;
          }
          
          const litre = document.getElementById('litre');
          const link = sessionToken ? "Dp" : "result";
          themes.sort((a, b) => b.topicality - a.topicality)
          for (i = 0; i < 3; i++) {
            const li = document.createElement('li');
            li.innerHTML = `<img src="${themes[i].imageURI}"><a href ="${link}${themes[i].themeID}">${themes[i].title}</a>`;
            litre.appendChild(li);
          }
          if (!hisProfile.isInfluencer) { $('#onlyinfluencer').remove(); }
          else {  }
          if (which == "twitter") {
            $('#profile2').append($('<img src="' + hisProfile.imageURI + '"><h4>' + hisProfile.name + '<br><a href="https://twitter.com/' + hisProfile.name + '" style="text-decoration:none; color:deepskyblue;">ツイッターを確認</a></h4>'));
          } else if (which == "legacy") {
            $('#profile2').append($('<img src="' + hisProfile.imageURI + '"><h4>' + hisProfile.name + '<br><a href="https://twitter.com/search?q=' + hisProfile.name + '&f=user" style="text-decoration:none; color:deepskyblue;">ツイッターを確認</a></h4>'));
          }
          

          hisProfile.votes.forEach(element => {
            themes.forEach(theme => {
              if (element.themeID == theme.themeID){
                $('#pv').append($('<li><img src="' + theme.imageURI + '"><a href ="' + link + theme.themeID + '" style="text-decoration:none; color:black;">' + theme.title + '</a></li>'));
              }
            })
          });
        } catch (e) {
          console.log( e.message );
          
        }
      }

      $(() => { main(); })
    </script>
    <div class="mainSite">
      <div class="header">
        <div class="header-logo"><a href="home"><img src="/images/aice.JPG"></a>
        </div>
        <div id="nav-drawer">
          <input id="nav-input" type="checkbox" class="nav-unshown">
          <label id="nav-open" for="nav-input"><span></span></label>
          <label class="nav-unshown" id="nav-close" for="nav-input"></label>
          <div id="nav-content">
            <ul>
              <li><a href="explain" style="text-decoration:none; color:white;">aicevoteとは</a></li>
              <li><a href="about_us" style="text-decoration:none; color:white;">運営者情報</a></li>
              <li><a href="apply" style="text-decoration:none; color:white;">投票テーマの応募</a></li>
              <li><a href="feedback" style="text-decoration:none; color:white;">フィードバック</a></li>
              <li><a href="qanda" style="text-decoration:none; color:white;">Q&A</a></li>
              <li class="Login"><a href="./login" style="text-decoration:none; color:white;">Login</a>
              <li>
            </ul>
          </div>
        </div>
        <div class="header-list">
          <ul>
            <li><a href="explain" style="text-decoration:none; color:white;">aicevoteとは</a></li>
            <li><a href="about_us" style="text-decoration:none; color:white;">about us</a></li>
            <li><a href="feedback" style="text-decoration:none; color:white;">feedback</a></li>
            <li><a href="apply" style="text-decoration:none; color:white;">応募</a></li>
            <li><a href="qanda" style="text-decoration:none; color:white;">Q&A</a></li>
            <li>
              <div class="Login"><a href="./login" style="text-decoration:none; color:white;">Login</a></div>
            </li>
          </ul>
        </div>
        <div id="menu-background">
        </div>
      </div>
      <div id="allcontainer">
        <div class="container">
          <div id="profile2"></div>
          <div id="onlyinfluencer">
            <h5>認定インフルエンサー</h5>
          </div>
          <div id="timeline"><h2>タイムライン</h2>
            <h4>
              <p>
                友達の投票をリアルタイムに通知し、新しいテーマやニュースがわかります。
              </p>
              <p>
                タイムラインを使うにはアプリをダウンロード!
              </p>
            </h4>
          </div>
          <div id="pastvote"><h2>投票履歴</h2>
            <ul id="pv">

            </ul>
          </div>
        </div>
        <div class="subcontents">
          <div class="adpc">
            <a href="https://px.a8.net/svt/ejp?a8mat=35UA59+5E3BZM+1WP2+6D4GH" rel="nofollow">
              <img border="0" width="300" height="250" alt=""
                src="https://www26.a8.net/svt/bgt?aid=191209437326&wid=001&eno=01&mid=s00000008903001069000&mc=1"></a>
            <img border="0" width="1" height="1" src="https://www13.a8.net/0.gif?a8mat=35UA59+5E3BZM+1WP2+6D4GH" alt="">
          </div>
          <div class="adsmart">
            <a href="https://px.a8.net/svt/ejp?a8mat=35UA59+5E3BZM+1WP2+66H9D" rel="nofollow">
              <img border="0" width="234" height="60" alt=""
                src="https://www22.a8.net/svt/bgt?aid=191209437326&wid=001&eno=01&mid=s00000008903001038000&mc=1"></a>
            <img border="0" width="1" height="1" src="https://www12.a8.net/0.gif?a8mat=35UA59+5E3BZM+1WP2+66H9D" alt="">
          </div>

          <h2>人気の投票テーマ</h2>
          <ul id="litre">
          </ul>
        </div>
      </div>
      <div id="userimg"></div>
      <div class="footer">
        <h1><img src="/images/firstix-ocean.png"></h1>
        <ul>
          <li>
            <a href="https://twitter.com/aicevote" style="text-decoration:none; color:deepskyblue;">お問い合わせ</a>
          </li>
          <li>
            <a href="Terms" style="text-decoration:none; color:deepskyblue;">プライバシーポリシー</a>
          </li>
          <li>
            <a href="https://qiita.com/akaoni_sohei/items/186121bd9994197aab50"
              style="text-decoration:none; color:deepskyblue;">
              レポート
            </a>
          </li>
        </ul>
      </div>
    </div>
  </body>

</html>